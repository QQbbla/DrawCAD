# 基于遗传算法的平面异形图排样优化系统

[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![Python Version](https://img.shields.io/badge/python-3.8%2B-blue.svg)](https://www.python.org/downloads/)
本项目是一个专注于解决**平面异形图排样（Nesting）**问题的智能优化系统。它利用**遗传算法（Genetic Algorithm, GA）** 在给定的板材上对一组不规则形状的零件进行布局，旨在实现最高的材料利用率。

![项目效果演示](https://path.to/your/demo_image.gif)  
*(请将上方链接替换为您项目的效果图或GIF动图)*

---

## 目录

- [项目背景与难点](#项目背景与难点)
- [解决方案：为何选择遗传算法](#解决方案为何选择遗传算法)
- [核心特性](#核心特性)
- [安装指南](#安装指南)
- [快速开始](#快速开始)
- [算法详解](#算法详解)
  - [1. 染色体编码](#1-染色体编码)
  - [2. 适应度函数](#2-适应度函数)
  - [3. 选择、交叉与变异](#3-选择交叉与变异)
- [项目成果展示](#项目成果展示)
- [未来工作 (TODO)](#未来工作-todo)
- [贡献指南](#贡献指南)
- [许可证](#许可证)

## 项目背景与难点

在工业生产（如钣金加工、皮革裁剪、服装制造）中，如何将多个不规则形状的零件（异形图）高效地排布在原材料板上，是一个至关重要的问题。这个问题通常被称为**二维不规则排样问题（2D Irregular Shape Nesting Problem）**。其核心目标是最小化原材料的消耗，从而降低成本。

该问题是典型的 **NP-hard** 问题，其主要难点包括：

1.  **巨大的搜索空间**: 每个零件的位置（x, y坐标）和旋转角度都是连续变量，组合起来构成了无穷大的搜索空间。
2.  **复杂的几何约束**: 必须确保所有零件都位于板材边界内，且零件之间不能发生重叠。处理不规则形状的碰撞检测计算量巨大。
3.  **易于陷入局部最优**: 传统的确定性算法或贪心算法很容易陷入一个局部最优解，无法找到全局最优的布局方案。
4.  **形状多样性**: 零件可能包含凹多边形、孔洞等复杂几何特征，增加了处理难度。

## 解决方案：为何选择遗传算法

为了克服上述难点，本项目采用了**遗传算法**作为核心优化引擎。遗传算法是一种模拟自然界生物进化过程的全局优化启发式算法，特别适合解决此类复杂的组合优化问题。

- **全局搜索能力**: 通过种群迭代和概率性的选择、交叉、变异操作，遗传算法能够探索整个解空间，有效避免陷入局部最优。
- **灵活性与鲁棒性**: 算法不依赖于问题的具体数学解析式，对复杂、非线性的适应度函数（如材料利用率）有很好的适应性。
- **并行处理潜力**: 遗传算法的种群评估过程可以很自然地进行并行化处理，从而加速寻优过程。

本项目通过精心设计的**编码方案**、**适应度函数**以及**遗传算子**，将排样问题转化为一个寻优过程，最终迭代出高利用率的布局方案。

## 核心特性

- **支持多种格式**: 支持导入DXF、SVG或自定义JSON格式的异形图数据。
- **高效的遗传算法核心**: 实现了高效的选择（如轮盘赌、锦标赛）、交叉和变异算子。
- **精确的碰撞检测**: 内置了高效的几何计算库，用于精确判断异形图之间的重叠。
- **可视化输出**: 可将最优布局方案以图片或矢量图格式输出，方便查看。
- **可配置参数**: 用户可以方便地调整遗传算法的参数，如种群大小、迭代次数、变异率等。

## 安装指南

1.  克隆本仓库到本地：
    ```bash
    git clone [https://github.com/your_username/your_project_name.git](https://github.com/your_username/your_project_name.git)
    cd your_project_name
    ```

2.  (推荐) 创建并激活一个虚拟环境：
    ```bash
    python -m venv venv
    source venv/bin/activate  # on Windows, use `venv\Scripts\activate`
    ```

3.  安装项目依赖：
    (请确保你有一个 `requirements.txt` 文件)
    ```bash
    pip install -r requirements.txt
    ```
    *常见的依赖可能包括 `numpy`, `shapely`, `matplotlib`等。*

## 快速开始

通过以下命令即可启动一个优化任务：

```bash
python main.py --input "path/to/your/shapes_directory" --output "path/to/save/results" --width 1000 --height 800
```

- `--input`: 存放异形图文件的目录。
- `--output`: 保存优化结果（如布局图、日志）的目录。
- `--width`, `--height`: 原材料板材的宽度和高度。

## 算法详解

遗传算法如何解决此问题的核心在于以下三个方面：

### 1. 染色体编码

我们将一个完整的排样方案（解）编码为一个**染色体**。染色体是一个序列，代表了零件放入板材的顺序。每个基因除了包含零件ID外，还可以包含该零件的旋转角度等信息。

例如，一个染色体可以是 `[(part_3, 90_deg), (part_1, 0_deg), (part_5, 180_deg), ...]`。

布局时，算法会按照染色体定义的顺序和角度，依次将零件通过某种放置策略（如从左下角开始的“滑落”策略）紧凑地放入板材。

### 2. 适应度函数

**适应度函数 (Fitness Function)** 用于评价一个排样方案（染色体）的优劣。我们的目标是最大化材料利用率，这等价于最小化包含所有已排零件的**包络矩形（Bounding Box）** 的面积。

适应度函数 `f(x)` 可以定义为：

$$ f(x) = \frac{1}{A_{bbox}} $$

其中，$A_{bbox}$ 是该布局方案的包络矩形面积。$A_{bbox}$ 越小，适应度值越高，代表这个解越优。

### 3. 选择、交叉与变异

- **选择 (Selection)**: 根据适应度值，从当前种群中选择优秀的个体（父代）进入下一代。采用**锦标赛选择**或**轮盘赌选择**策略，让更优的解有更高的概率被选中。

- **交叉 (Crossover)**: 两个父代染色体交换部分基因，生成新的子代。例如，采用**顺序交叉 (Order Crossover, OX)**，以保留父代中零件的相对顺序信息。

- **变异 (Mutation)**: 以一定的低概率随机改变子代染色体上的基因。例如，随机交换两个零件的顺序、或随机改变某个零件的旋转角度。这有助于维持种群多样性，防止过早收敛。

通过不断重复“**评估 -> 选择 -> 交叉 -> 变异**”的迭代过程，种群整体的适应度将不断提升，最终收敛到接近全局最优的排样方案。

## 项目成果展示

*(在此处展示一些有代表性的成果)*

**示例1：基础多边形排样**

- **输入**: 10个不同的多边形零件
- **板材尺寸**: 100x100
- **最终利用率**: 85.7%

![示例1结果](https://path.to/your/result1.png)

**示例2：复杂凹多边形排样**

- **输入**: 5个带凹陷的复杂零件
- **板材尺寸**: 50x50
- **最终利用率**: 79.2%

![示例2结果](https://path.to/your/result2.png)

## 未来工作 (TODO)

- [ ] 实现更高效的“无重叠（No-Fit Polygon, NFP）”算法以加速放置过程。
- [ ] 增加对带孔洞零件的支持。
- [ ] 开发一个简单的图形用户界面（GUI），方便用户交互。
- [ ] 引入多线程/并行计算，加速适应度评估过程。
- [ ] 探索混合算法，如结合模拟退火或局部搜索来进一步优化结果。

## 贡献指南

我们欢迎任何形式的贡献！无论是提交bug报告、建议新功能还是直接贡献代码。请遵循以下步骤：

1.  Fork 本项目。
2.  创建您的特性分支 (`git checkout -b feature/AmazingFeature`)。
3.  提交您的更改 (`git commit -m 'Add some AmazingFeature'`)。
4.  将您的分支推送到远程 (`git push origin feature/AmazingFeature`)。
5.  创建一个 Pull Request。

## 许可证

本项目采用 [MIT 许可证](LICENSE.txt) 进行授权。详情请见 `LICENSE.txt` 文件。